<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <title>easyFlete</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/semantic.min.css">
    <link rel="stylesheet" href="css/easyFlete.css">
    <script src="js/jquery.js"></script>
    <script src="js/semantic.min.js"></script>
    <script src="https://openlayers.org/en/v4.1.0/build/ol.js"></script>
    <link rel="stylesheet" href="https://openlayers.org/en/v4.1.0/css/ol.css" type="text/css">
    <script src="js/easyFlete.js" type="text/javascript"></script>
    <body>
        <script>
            $(document).ready(function () {
                $('.masthead').visibility({
                    once: false,
                    onBottomPassed: function () {
                        $('.fixed.menu').transition('fade in');
                    },
                    onBottomPassedReverse: function () {
                        $('.fixed.menu').transition('fade out');
                    }
                });
                $('.ui.sidebar').sidebar('attach events', '.toc.item');
                $('.ui.embed').embed();
            });
        </script>
        <div class="ui vertical inverted sidebar menu left w3-easyFlete-grey"> <img src="img/easyFlete-white.png" style="height: 30px" class="w3-margin-left w3-margin-top"> <a href="/inicio" class="active item">Solicitar</a> <a class="item" href="/login">Iniciar Sesi&oacute;n</a> <a class="item" href="/registrarse">Registrarse</a> </div>
        <div class="pusher">
            <div class="ui inverted vertical masterhead masthead center aligned segment w3-easyFlete-grey w3-bottombar" id="backgr" style="background-image: url(img/ub1610v2.jpg); background-repeat: no-repeat; background-position: right">
                <div class="ui container">
                    <div class="ui large secondary inverted pointing menu w3-border-0"> <a class="toc item"> <i class="sidebar black icon"></i> </a> <img src="img/easyFlete.png" class="item" style="height: 55px">
                        <div class="right item w3-hide-small"> <a class="ui secondary button w3-easyFlete-orange" href="/login">Iniciar Sesi&oacute;n</a> <a class="ui button w3-easyFlete-grey" href="/registrarse">Registrarse</a> </div>
                    </div>
                </div>
                <div class="ui text container">
                    <h1 class="ui inverted header"> </h1>
                    <h2 class="w3-text-easyFlete-grey">Luegar de encuentro para clientes y fleteros.</h2>
                    <div class="ui huge grey button w3-margin-top">Ver Demo <i class="right arrow icon"></i></div>
                </div>
            </div>
            <div style="background-color: #FBFBFB">
                <div id="intro" class="w3-content w3-padding-64">
                    <h2 class="w3-center w3-margin-bottom ui horizontal divider header w3-padding w3-padding-24 w3-text-easyFlete-orange">Introducci&oacute;n</h2>
                    <h4 class="w3-center ui header w3-padding-24">easyFlete es una plataforma web que te permite publicar y aceptar solicitudes para realizar fletes.</h4>
                    <h4 class="w3-center ui header">Tus solicitudes son vistas por cientos de fleteros, que luego podr&aacute;n aceptar el trabajo.<br>
                        Coordina con el fletero de forma sencilla y r&aacute;pida, para poder llevar a cabo el flete cuando as&iacute; lo desees.</h4>
                </div>
            </div>
            <div class="w3-padding-24 w3-card w3-white">
                <div class="w3-content w3-padding-48 w3-margin-bottom">
                    <h2 class="w3-center w3-margin-bottom ui horizontal divider header w3-padding w3-padding-24 w3-text-easyFlete-orange">F&aacute;cil de utilizar</h2>
                    <h4 class="w3-center ui header">Ya sea estando registrado o no, easyFlete hace sencillo y r&aacute;pido la publicaci&oacute;n de tus solicitudes en la plataforma.</h4>
                    <div class="w3-content w3-padding-32 w3-margin-top w3-center">
                        <div class="ui large steps">
                            <div class="step"> <i class="info icon w3-margin-right w3-text-easyFlete-orange"></i>
                                <div class="content">
                                    <div class="title">Informaci&oacute;n B&aacute;sica</div>
                                    <div class="description">necesaria para crear el flete</div>
                                </div>
                            </div>
                            <div class="step"> <i class="user icon w3-text-easyFlete-orange"></i>
                                <div class="content">
                                    <div class="title">Informaci&oacute;n de Contacto</div>
                                    <div class="description">para poder coordinar</div>
                                </div>
                            </div>
                            <div class="step"> <i class="marker w3-text-easyFlete-orange icon"></i>
                                <div class="content">
                                    <div class="title">Ruta del Flete</div>
                                    <div class="description">establece origen y destino del flete</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="w3-padding w3-padding-64 bgimg-2 w3-card">
                <h2 class="ui center aligned icon header"> <i class="marker icon w3-text-easyFlete-orange"></i><span class="w3-text-easyFlete-grey">Solicitar Flete</span> </h2>
            </div>
            <div class="w3-padding w3-panel w3-padding-24" style="min-height: 600px">
                <div class="ui active dimmer" style="display: none" id="dimmer">
                    <div class="ui text loader" id="loading" style="display: none">Por favor espere...</div>
                    <div class="w3-display-middle" id="exito" style="display: none">
                        <img src="img/success.svg" style="height: 45px"><br>
                        <h4 style="color: white">Tu Solicitud ha sido creada correctamente!</h4>
                        <button class="ui secondary button w3-easyFlete-grey w3-center" onclick="ocultarMensajes()">Aceptar</button>
                    </div>
                    <div class="w3-display-middle" id="error" style="display: none">
                        <img src="img/error.svg" style="height: 45px"><br>
                        <h4 style="color: white">Ha ocurrido un error, y no se podido crear la solicitud.<br>Por favor vuelve a intentar</h4>
                        <button class="ui secondary button w3-easyFlete-grey w3-center" onclick="ocultarMensajes()">Aceptar</button>
                    </div>
                    <div class="w3-display-middle" id="warning" style="display: none">
                        <img src="img/warning.svg" style="height: 45px"><br>
                        <h4 style="color: white"> Completa los datos necesarios para poder crear tu solicitud.</h4>
                        <button class="ui secondary button w3-easyFlete-grey w3-center" onclick="ocultarMensajes()">Aceptar</button>
                    </div>
                </div>
                <div class="w3-content">
                    <div class="w3-col s12 m4 l4">
                        <div class="ui vertical steps">
                            <div class="active link step" onClick="mostrarStep1()" id="s1"> <i class="info icon"></i>
                                <div class="content">
                                    <div class="title">Informaci&oacute;n B&aacute;sica</div>
                                    <div class="description">Datos necesarios para crear tu flete</div>
                                </div>
                            </div>
                            <div class="link step" id="s2" onClick="mostrarStep2()"> <i class="user card icon"></i>
                                <div class="content">
                                    <div class="title">Informaci&oacute;n de Contacto</div>
                                    <div class="description">Datos necesarios para contactarte</div>
                                </div>
                            </div>
                            <div class="link step" id="s3" onClick="mostrarStep3()"> <i class="marker card icon"></i>
                                <div class="content">
                                    <div class="title">Ruta del Flete</div>
                                    <div class="description">Origen y Destino del Flete</div>
                                </div>
                            </div>
                            <div class="link step" id="s4" onClick="mostrarStep4()"> <i class="checkmark icon"></i>
                                <div class="content">
                                    <div class="title">Confirmar Solicitud</div>
                                    <div class="description">Revisa y confirma tu solicitud</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="w3-col s12 m8 l8">
                        <div id="step1" class="w3-padding w3-margin">
                            <h4 class="ui horizontal divider header w3-padding w3-text-easyFlete-orange">Informaci&oacute;n B&aacute;sica</h4>
                            <div class="ui labeled fluid input w3-margin">
                                <div class="ui label">T&iacute;tulo:</div>
                                <input id="titulo" placeholder="Ingrese un t&iacute;tulo para el flete..." type="text">
                            </div>
                            <div class="ui right labeled fluid input w3-margin">
                                <div class="ui label">Carga:</div>
                                <input id="peso" placeholder="Ingrese la carga a transportar..." type="text">
                                <div class="ui basic label">Kg</div>
                            </div>
                            <div class="ui right labeled fluid input w3-margin">
                                <div class="ui label">Precio:</div>
                                <input id="precioMax" placeholder="Ingrese el precio m&aacute;ximo a pagar..." type="text">
                                <div class="ui basic label">UY</div>
                            </div>
                            <div class="ui labeled fluid input w3-margin">
                                <div class="ui label">Fecha:</div>
                                <input id="fecha" placeholder="Ingrese la fecha del flete..." type="date">
                            </div>
                            <div class="ui labeled fluid input w3-margin">
                                <div class="ui label">Hora:</div>
                                <input id="hora" placeholder="Ingrese una hora para el flete..." type="datetime">
                            </div>
                            <div class="ui reply form w3-margin">
                                <div class="field">
                                    <textarea id="descripcion" cols="30" rows="5" style="min-height: 100px" placeholder="Escriba aqu&iacute; una descripci&oacute;n para el flete..."></textarea>
                                </div>
                            </div>
                        </div>
                        <div id="step2" style="display: none" class="w3-padding w3-margin">
                            <h4 class="ui horizontal divider header w3-padding w3-text-easyFlete-orange">Informaci&oacute;n de Contacto</h4>
                            <div class="ui labeled fluid input w3-padding">
                                <div class="ui label">Nombre:</div>
                                <input id="nombre" type="text" name="nombre" placeholder="Ingrese su nombre" required>
                            </div>
                            <div class="ui labeled fluid input w3-padding">
                                <div class="ui label">Tel&eacute;fono:</div>
                                <input placeholder="Ingrese su tel&eacute;fono..." id="telefono" type="tel" name="tel" required>
                            </div>
                            <div class="ui labeled fluid input w3-padding">
                                <div class="ui label">Email:</div>
                                <input id="email" type="email" name="email" placeholder="Ingrese su direcci&oacute;n de correo..." required>
                            </div>
                        </div>
                        <div id="step3" style="display: none" class="w3-padding w3-margin">
                            <h4 class="ui horizontal divider header w3-padding w3-text-easyFlete-orange">Ruta del Flete</h4>
                            <div class="ui segment">
                                <h4 class="ui left floated header">Origen <br>
                                    <p style="font-size: 13px" class="w3-text-easyFlete-grey">escribe el nombre de la calle, seguido del numero de puerta</p>
                                </h4>
                                <div class="ui icon button circular w3-right" data-tooltip="Marcar Origen" onclick="dibujarPunto('Origen')"><i class="write icon black"></i></div>
                                <div class="ui clearing divider"></div>
                                <select name="origen" id="origen" class="ui fluid search dropdown">
                                    <option value="" selected disabled>Busque una calle</option>
                                    <option value="Easy Flete" >Easy Flete</option>
                                </select>
                            </div>
                            <div class="ui segment">
                                <h4 class="ui left floated header">Destino <br>
                                    <p style="font-size: 13px" class="w3-text-easyFlete-grey">escribe el nombre de la calle, seguido del numero de puerta</p>
                                </h4>
                                <div class="ui icon button circular w3-right" data-tooltip="Marcar Destino" onclick="dibujarPunto('Destino')"><i class="write icon black"></i></div>
                                <div class="ui clearing divider"></div>
                                <select name="destino" id="destino" class="ui fluid search dropdown">
                                    <option value="" selected disabled>Busque una calle</option>
                                    <option value="Easy Flete" >Easy Flete</option>
                                </select>
                            </div>
                            <script>
                                var busquedaOld;
                                $("#origen").dropdown({
                                    onNoResults: function (searchValue) {
                                        if (searchValue.length >= 3 && searchValue !== busquedaOld) {
                                            busquedaOld = searchValue;
                                            setTimeout(function () {
                                                if (searchValue === busquedaOld) {
                                                    $.get("http://localhost:10070/calles/calleNum/" + searchValue, function (result) {
                                                        setTimeout(function () {
                                                            if (searchValue === busquedaOld && result.toString() !== "") {
                                                                var x = document.getElementById("origen");
                                                                x.options.length = 0;
                                                                var option1 = document.createElement("option");
                                                                option1.value = "";
                                                                option1.disabled;
                                                                x.add(option1);
                                                                for (i = 0; i < result.length; i++) {
                                                                    var option = document.createElement("option");
                                                                    option.text = result[i];
                                                                    option.value = result[i];
                                                                    x.add(option);
                                                                }
                                                            }
                                                        }, 500);
                                                    });
                                                }
                                            }, 750);

                                        }
                                    }
                                });

                                $("#destino").dropdown({
                                    onNoResults: function (searchValue) {
                                        if (searchValue.length >= 3 && searchValue !== busquedaOld) {
                                            busquedaOld = searchValue;
                                            setTimeout(function () {
                                                if (searchValue === busquedaOld) {
                                                    $.get("http://localhost:10070/calles/calleNum/" + searchValue, function (result) {
                                                        setTimeout(function () {
                                                            if (searchValue === busquedaOld && result.toString() !== "") {
                                                                var x = document.getElementById("destino");
                                                                x.options.length = 0;
                                                                var option1 = document.createElement("option");
                                                                option1.value = "";
                                                                option1.disabled;
                                                                x.add(option1);
                                                                for (i = 0; i < result.length; i++) {
                                                                    var option = document.createElement("option");
                                                                    option.text = result[i];
                                                                    option.value = result[i];
                                                                    x.add(option);
                                                                }
                                                            }
                                                        }, 500);
                                                    });
                                                }
                                            }, 750);

                                        }
                                    }
                                });
                            </script> 
                        </div>
                        <div id="step4" class="w3-padding w3-margin" style="display: none"> 
                            <h4 class="ui horizontal divider header w3-padding w3-text-easyFlete-orange">Confirmar Solicitud</h4>
                            <div class="w3-padding w3-padding-48 w3-center">
                                <button class="huge ui secondary inverted button w3-easyFlete-orange w3-center" onclick="ingresar()">Crear Flete</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="w3-content w3-padding" style="margin-bottom: 50px">
                <div class="w3-card-4 w3-round" id="map" style="height: 400px; width: 100%"></div>
            </div>
            <div class="w3-padding-48 w3-card" style="background-color: #FBFBFB">
                <div class="w3-content w3-padding-48 w3-margin-bottom">
                    <h2 class="w3-center w3-margin-bottom ui horizontal divider header w3-padding w3-padding-24 w3-text-easyFlete-orange">Demo</h2>
                    <h4 class="w3-center ui header">Mir&aacute; la demo para conocer a&uacute;n mas sobre easyFlete</h4>
                    <div class="w3-content w3-padding-32 w3-margin-top w3-center">
                        <div class="ui embed w3-card" data-source="youtube" data-id="Nw1643T0RD0" data-placeholder="img/fondo.png">
                        </div>
                    </div>
                </div>
            </div>
            <div class="ui inverted vertical footer segment">
                <div class="ui container">
                    <div class="ui stackable inverted divided equal height stackable grid">
                        <div class="four wide right aligned column">
                            <h5>T.S.I.G - 2017</h5>
                            <h5>Grupo 15</h5>
                        </div>
                        <div class="four wide center aligned column">
                            <h4 class="ui inverted header">Integrantes:</h4>
                            <div class="ui inverted link list"> <a href="#" class="item">Bruno Carballido</a> <a href="#" class="item">Enzo Drago</a> <a href="#" class="item">Agust&iacute;n Maidana</a> <a href="#" class="item">Pedro Moretto</a> </div>
                        </div>
                        <div class="six wide column"> <img src="img/easyFlete.gif" style="height: 25px">
                            <p>Luegar de encuentro para clientes y fleteros</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            var raster = new ol.layer.Tile({source: new ol.source.OSM()});
            var source = new ol.source.Vector({wrapX: false});
            var vector = new ol.layer.Vector({source: source});
            var typeSelect = "Point";
            var map = new ol.Map({
                layers: [raster, vector],
                target: 'map',
                view: new ol.View({
                    projection: 'EPSG:4326',
                    center: [-56.16466616190428, -34.89647351494282],
                    zoom: 12
                })
            });

            var vector_layerO;
            var vector_layerD;

            var latlonOri = "";
            var latlonDes = "";


            $(document).ready(function () {
                "use strict";
                blurBackground();
            });
        </script> 
        <script>
            function dibujarPunto(tipo) {

                var docOrigen = document.getElementById("origen").value.toString();
                var docDestino = document.getElementById("destino").value.toString();


                if ((tipo === "Origen" && docOrigen !== "") || (tipo === "Destino" && docDestino !== "")) {
                    var nomCalle;
                    var numPuerta;
                    var tmp;

                    if (tipo === "Origen") {
                        tmp = docOrigen.split(",");
                        if (tmp.length === 2) {
                            nomCalle = tmp[0].toString().trim();
                            numPuerta = tmp[1].toString().trim();
                        } else {
                            alert("Debe espesificar numero de puerta");
                        }
                    } else if (tipo === "Destino") {
                        tmp = docDestino.split(",");
                        if (tmp.length === 2) {
                            nomCalle = tmp[0].toString().trim();
                            numPuerta = tmp[1].toString().trim();
                        } else {
                            alert("Debe espesificar numero de puerta");
                        }
                    }

                    $.post("http://localhost:10070/calles/geo", "nombre=" + nomCalle + "&numero=" + numPuerta, function (resultNum) {

                        var xy = resultNum.split(",");

                        var point_feature = new ol.Feature({});
                        var point_geom = new ol.geom.Point([xy[0], xy[1]]);
                        point_feature.setGeometry(point_geom);

                        if (tipo === "Origen") {
                            if (latlonOri !== "") {
                                map.removeLayer(vector_layerO);
                            }
                            latlonOri = resultNum;
                            vector_layerO = new ol.layer.Vector({
                                source: new ol.source.Vector({
                                    features: [point_feature]
                                }),
                                style: new ol.style.Style({
                                    image: new ol.style.Circle({
                                        radius: 7,
                                        fill: new ol.style.Fill({
                                            color: 'rgb(124, 215, 238)'
                                        })
                                    })
                                })
                            });
                            map.addLayer(vector_layerO);
                        } else if (tipo === "Destino") {
                            if (latlonDes !== "") {
                                map.removeLayer(vector_layerD);
                            }
                            latlonDes = resultNum;
                            vector_layerD = new ol.layer.Vector({
                                source: new ol.source.Vector({
                                    features: [point_feature]
                                }),
                                style: new ol.style.Style({
                                    image: new ol.style.Circle({
                                        radius: 7,
                                        fill: new ol.style.Fill({
                                            color: 'orange'
                                        })
                                    })
                                })
                            });
                            map.addLayer(vector_layerD);
                        }

                        map.setView(new ol.View({
                            projection: 'EPSG:4326',
                            center: [Number(xy[0]), Number(xy[1])],
                            zoom: 14
                        }));
                    });
                }
            }

            function mostrarMensajeExito() {
                document.getElementById("dimmer").style.display = "block";
                document.getElementById("exito").style.display = "block";
                document.getElementById("error").style.display = "none";
                document.getElementById("warning").style.display = "none";
                document.getElementById("loading").style.display = "none";

            }

            function mostrarMensajeError() {
                document.getElementById("dimmer").style.display = "block";
                document.getElementById("exito").style.display = "none";
                document.getElementById("error").style.display = "block";
                document.getElementById("warning").style.display = "none";
                document.getElementById("loading").style.display = "none";
            }

            function mostrarMensajeWarning() {
                document.getElementById("dimmer").style.display = "block";
                document.getElementById("exito").style.display = "none";
                document.getElementById("error").style.display = "none";
                document.getElementById("warning").style.display = "block";
                document.getElementById("loading").style.display = "none";
            }

            function mostrarMensajeLoading() {
                document.getElementById("dimmer").style.display = "block";
                document.getElementById("exito").style.display = "none";
                document.getElementById("error").style.display = "none";
                document.getElementById("warning").style.display = "none";
                document.getElementById("loading").style.display = "block";
            }

            function ocultarMensajes() {
                document.getElementById("dimmer").style.display = "none";
                document.getElementById("exito").style.display = "none";
                document.getElementById("error").style.display = "none";
                document.getElementById("warning").style.display = "none";
                document.getElementById("loading").style.display = "none";
            }

            function ingresar() {

                var titulo = document.getElementById("titulo").value;
                var hora = document.getElementById("hora").value;
                var peso = document.getElementById("peso").value;
                var descripcion = document.getElementById("descripcion").value;
                var fecha = document.getElementById("fecha").value;
                var precioMax = document.getElementById("precioMax").value;
                var email = document.getElementById("email").value;
                var nombre = document.getElementById("nombre").value;
                var telefono = document.getElementById("telefono").value;
                if (latlonOri !== "" && latlonDes !== "" && titulo !== "" && fecha !== "" && precioMax !== "" && email !== "" && nombre !== "" && telefono !== "") {
                    mostrarMensajeLoading();
                    $.post("http://localhost:10070/clientes", "nombre=" + nombre + "&email=" + email + "&telefono=" + telefono, function (result1) {
                        if (peso === "")
                            peso = "0";

                        var wgs84Sphere = new ol.Sphere(6378137);
                        var xy = latlonOri.split(",");
                        var xy2 = latlonDes.split(",");
                        var length = wgs84Sphere.haversineDistance([Number(xy[0]), Number(xy[1])], [Number(xy2[0]), Number(xy2[1])]);
                        var dist = (Math.round(length / 1000 * 100) / 100);

                        var postInfo = "origen=" + latlonOri + "&destino=" + latlonDes + "&titulo=" + titulo + "&peso=" + peso + "&hora=" + hora + "&descripcion=" + descripcion + "&fecha=" + fecha + "&precioMax=" + precioMax + "&email=" + email + "&distancia=" + dist;
                        $.post("http://localhost:10070/solicitudes", postInfo, function (result) {
                            if (result === true) {
                                mostrarMensajeExito();
                            } else {
                                mostrarMensajeError();
                            }
                        });
                    });
                } else {
                    mostrarMensajeWarning();
                }
            }
        </script>
    </body>
</html>
